import{Settings as e,ObjectWrapper as t,UIString as n}from"../common/common.js";import{ls as a}from"../platform/platform.js";import{Widget as s,UIUtils as i,SettingsUI as o,Utils as r,Toolbar as d,Icon as c,Tooltip as l,InspectorView as g}from"../ui/ui.js";import{TargetDetachedDialog as u}from"../components/components.js";import{InspectorFrontendHost as p,InspectorFrontendHostAPI as h}from"../host/host.js";import{NetworkPanelIndicator as m}from"../mobile_throttling/mobile_throttling.js";import{Runtime as S}from"../root/root.js";import{Connections as b,SDKModel as _,DebuggerModel as f,ResourceTreeModel as C,ChildTargetManager as v}from"../sdk/sdk.js";let F;class w extends s.VBox{constructor(){super(!0),this.registerRequiredCSS("inspector_main/renderingOptions.css",{enableLegacyPatching:!1}),this._appendCheckbox(a`Paint flashing`,a`Highlights areas of the page (green) that need to be repainted. May not be suitable for people prone to photosensitive epilepsy.`,e.Settings.instance().moduleSetting("showPaintRects")),this._appendCheckbox(a`Layout Shift Regions`,a`Highlights areas of the page (blue) that were shifted. May not be suitable for people prone to photosensitive epilepsy.`,e.Settings.instance().moduleSetting("showLayoutShiftRegions")),this._appendCheckbox(a`Layer borders`,a`Shows layer borders (orange/olive) and tiles (cyan).`,e.Settings.instance().moduleSetting("showDebugBorders")),this._appendCheckbox(a`Frame Rendering Stats`,a`Plots frame throughput, dropped frames distribution, and GPU memory.`,e.Settings.instance().moduleSetting("showFPSCounter")),this._appendCheckbox(a`Scrolling performance issues`,a`Highlights elements (teal) that can slow down scrolling, including touch & wheel event handlers and other main-thread scrolling situations.`,e.Settings.instance().moduleSetting("showScrollBottleneckRects")),this._appendCheckbox(a`Highlight ad frames`,a`Highlights frames (red) detected to be ads.`,e.Settings.instance().moduleSetting("showAdHighlights")),this._appendCheckbox(a`Hit-test borders`,a`Shows borders around hit-test regions.`,e.Settings.instance().moduleSetting("showHitTestBorders")),this._appendCheckbox(a`Disable local fonts`,a`Disables local() sources in @font-face rules. Requires a page reload to apply.`,e.Settings.instance().moduleSetting("localFontsDisabled")),this._appendCheckbox(a`Emulate a focused page`,a`Emulates a focused page.`,e.Settings.instance().moduleSetting("emulatePageFocus")),this.contentElement.createChild("div").classList.add("panel-section-separator"),this._appendSelect(a`Forces media type for testing print and screen styles`,e.Settings.instance().moduleSetting("emulatedCSSMedia")),this._appendSelect(a`Forces CSS prefers-color-scheme media feature`,e.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersColorScheme")),this._appendSelect(a`Forces CSS prefers-reduced-motion media feature`,e.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersReducedMotion")),(()=>{const e="(prefers-reduced-data: reduce)";return window.matchMedia(e).media===e})()&&this._appendSelect(a`Forces CSS prefers-reduced-data media feature`,e.Settings.instance().moduleSetting("emulatedCSSMediaFeaturePrefersReducedData")),this._appendSelect(a`Forces CSS color-gamut media feature`,e.Settings.instance().moduleSetting("emulatedCSSMediaFeatureColorGamut")),this.contentElement.createChild("div").classList.add("panel-section-separator"),this._appendSelect(a`Forces vision deficiency emulation`,e.Settings.instance().moduleSetting("emulatedVisionDeficiency")),this.contentElement.createChild("div").classList.add("panel-section-separator"),this._appendCheckbox(a`Disable AVIF image format`,a`Requires a page reload to apply and disables caching for image requests.`,e.Settings.instance().moduleSetting("avifFormatDisabled")),this._appendCheckbox(a`Disable WebP image format`,a`Requires a page reload to apply and disables caching for image requests.`,e.Settings.instance().moduleSetting("webpFormatDisabled")),this.contentElement.createChild("div").classList.add("panel-section-separator")}static instance(e={forceNew:null}){const{forceNew:t}=e;return F&&!t||(F=new w),F}_appendCheckbox(e,t,n){const a=i.CheckboxLabel.create(e,!1,t);o.bindCheckbox(a.checkboxElement,n),this.contentElement.appendChild(a)}_appendSelect(e,t){const n=o.createControlForSetting(t,e);n&&this.contentElement.appendChild(n)}}var y=Object.freeze({__proto__:null,RenderingOptionsView:w});class k extends t.ObjectWrapper{async run(){let e=!0;await b.initMainConnection((async()=>{const t=S.Runtime.queryParam("v8only")?_.Type.Node:_.Type.Frame,a=t===_.Type.Frame&&"sources"===S.Runtime.queryParam("panel"),s=_.TargetManager.instance().createTarget("main",n.UIString("Main"),t,null,void 0,a);if(e){if(e=!1,a){const e=s.model(f.DebuggerModel);e&&(e.isReadyToPause()||await e.once(f.Events.DebuggerIsReadyToPause),e.pause())}s.runtimeAgent().invoke_runIfWaitingForDebugger()}}),u.TargetDetachedDialog.webSocketConnectionLost),new T,new P,new m.NetworkPanelIndicator,p.InspectorFrontendHostInstance.events.addEventListener(h.Events.ReloadInspectedPage,(e=>{const t=e.data;C.ResourceTreeModel.reloadAllPages(t)}))}}class T{constructor(){function t(){let t=null;e.Settings.instance().moduleSetting("javaScriptDisabled").get()&&(t=c.Icon.create("smallicon-warning"),l.Tooltip.install(t,n.UIString("JavaScript is disabled"))),g.InspectorView.instance().setPanelIcon("sources",t)}e.Settings.instance().moduleSetting("javaScriptDisabled").addChangeListener(t),t()}}class P{constructor(){this._autoAttachSetting=e.Settings.instance().moduleSetting("autoAttachToCreatedPages"),this._autoAttachSetting.addChangeListener(this._updateAutoAttach,this),this._updateAutoAttach(),this._adBlockEnabledSetting=e.Settings.instance().moduleSetting("network.adBlockingEnabled"),this._adBlockEnabledSetting.addChangeListener(this._update,this),this._emulatePageFocusSetting=e.Settings.instance().moduleSetting("emulatePageFocus"),this._emulatePageFocusSetting.addChangeListener(this._update,this),_.TargetManager.instance().observeTargets(this)}_updateTarget(e){e.type()!==_.Type.Frame||e.parentTarget()||(e.pageAgent().invoke_setAdBlockingEnabled({enabled:this._adBlockEnabledSetting.get()}),e.emulationAgent().invoke_setFocusEmulationEnabled({enabled:this._emulatePageFocusSetting.get()}))}_updateAutoAttach(){p.InspectorFrontendHostInstance.setOpenNewWindowForPopups(this._autoAttachSetting.get())}_update(){for(const e of _.TargetManager.instance().targets())this._updateTarget(e)}targetAdded(e){this._updateTarget(e)}targetRemoved(e){}}v.ChildTargetManager.install();var A=Object.freeze({__proto__:null,InspectorMainImpl:k,ReloadActionDelegate:class{handleAction(e,t){switch(t){case"inspector_main.reload":return C.ResourceTreeModel.reloadAllPages(!1),!0;case"inspector_main.hard-reload":return C.ResourceTreeModel.reloadAllPages(!0),!0}return!1}},FocusDebuggeeActionDelegate:class{handleAction(e,t){const n=_.TargetManager.instance().mainTarget();return!!n&&(n.pageAgent().invoke_bringToFront(),!0)}},NodeIndicator:class{constructor(){const e=document.createElement("div"),t=r.createShadowRootWithCoreStyles(e,{cssFile:"inspector_main/nodeIcon.css",enableLegacyPatching:!1,delegatesFocus:void 0});this._element=t.createChild("div","node-icon"),e.addEventListener("click",(()=>p.InspectorFrontendHostInstance.openNodeFrontend()),!1),this._button=new d.ToolbarItem(e),this._button.setTitle(n.UIString("Open dedicated DevTools for Node.js")),_.TargetManager.instance().addEventListener(_.Events.AvailableTargetsChanged,(e=>this._update(e.data))),this._button.setVisible(!1),this._update([])}_update(e){const t=Boolean(e.find((e=>"node"===e.type&&!e.attached)));this._element.classList.toggle("inactive",!t),t&&this._button.setVisible(!0)}item(){return this._button}},SourcesPanelIndicator:T,BackendSettingsSync:P});export{A as InspectorMain,y as RenderingOptions};
